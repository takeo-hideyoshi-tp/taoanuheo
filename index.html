<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

  <script>
    class SuffixNode {
      constructor(s) {
        this.children = [];
        this.value = s;
      }

    }

    class SuffixTree {
      constructor() {
        this.root = new SuffixNode('');

      }
      insert(word, sign) {
        sign = sign || '#'
        var nodes = this.root.children;
        while (word) {
          this.addNodeByPrefix(nodes, word, sign)
          word = word.slice(1)
        }
      }
      addNodeByPrefix(nodes, word, sign) {
        var add = true
        for (var i = 0; i < nodes.length; i++) {
          var node = nodes[i]
          if (node.value[0] == word[0]) { //如果存在共同前缀
            var prefix = ''
            add = false
            for (var j = 0; j < word.length; j++) {
              if (node.value[j] != word[j]) {
                break
              }
            }
            console.log("比较的两个字符为", node.value, word)
            prefix = word.slice(0, j)
            var valueLen = node.value.length - 1 //去掉 #

            if (prefix === word) {

              var cur = new SuffixNode(prefix + sign); //创建新节点
              nodes[i] = cur; //反客为主
              console.log('创建节点的value', prefix + sign)
              console.log('修改节点的value', node.value, '为', node.value.slice(j));
              node.value = node.value.slice(j);
              cur.children.push(node);

            } else if (j === valueLen && word.length > valueLen) {
              //ab 与 abcd， 节点的value比word短，并且命中word所有字符
              console.log('修改节点的value', node.value, '为', prefix + sign)
              node.value = prefix + sign

              this.addNodeByPrefix(node.children, word.slice(j), sign)

            } else {
              //abcabxabcd 与 abxabcd， 原父节点的value比word长，只有局部前缀命中
              var cur = new SuffixNode(prefix + sign); //创建新节点
              console.log('创建节点的value', prefix + sign)
              nodes[i] = cur; //反客为主
              console.log('修改节点的value', node.value, '为', node.value.slice(j));
              node.value = node.value.slice(j);
              cur.children.push(node);
              console.log('添加另一个子节点', word.slice(j) + sign)
              cur.children.push(new SuffixNode(word.slice(j) + sign));

            }
          }
        }
        if (add) {
          console.log("没有前缀，添加新节点", word)
          nodes.push(new SuffixNode(word + sign))
        }
      }
    }

    var tree = new SuffixTree();
    //tree.insert("banana");
    tree.insert("abcabxabcd"); //con
    //banana
    // anana
    //  nana
    //   ana
    //    na
    //     a
    //======
    //abcabxabcd
    // bcabxabcd
    //  cabxabcd
    //   abxabcd
    //    bxabcd
    //     xabcd
    //      abcd
    //       bcd
    //        cd
    //         d
    console.log(tree);


  </script>
  <div id='root'></div>
</body>

</html>