<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>

  <script>

    var sum = [], min = [], max = [], m = 0;
    function build(n, array){
      //构建一个满二叉树，因此我们不能直接让二根树的叶子节点数等于元素个数，m可能大于n
      for( m=1; m<n; m<<=1){};
      sum  = new Array(n >> 2).fill(0)
      max  = new Array(n >> 2).fill(-Infinity)
      min  = new Array(n >> 2).fill(Infinity)
      //填充最底层的叶子节点
      for(var i = m + 1; i <= m+n; i++){
        min[i] =  max[i] = sum[i] = array.shift()
      }
      for(var i = m; i ; i--){
        console.log(i, sum[i<<1], sum[i<<1 |1])
        sum[i] = (sum[i<<1] || 0) + (sum[i<<1 | 1] || 0)
        max[i] = Math.max(max[i<<1] || -Infinity , (max[i<<1 | 1] || -Infinity))
        min[i] = Math.min(min[i<<1] || Infinity , (min[i<<1 | 1] || Infinity))
      }
    }
    var array = [10,18,12,5,7,11,4,15]
    build(array.length, array)
    function updateOne(k, value){
      for(var i=k+m+1;i;i>>=1){
        sum[i]+=value;
      }
    }
    function queryOne(k, value){
     return sum[k+m]
    }
    /*
function queryOne(x){
  x = x+1
  var res = 0
  while(x){
    res+=sum[x]
    x>>=1
  }
  return res;

  //return sum[k+m+1]
}
*/
console.log(sum.concat())
console.log(queryOne(2)) //5 从零开始
console.log(queryOne(1)) // 6从零开始



function queryRangeMax( s, t){
    var max = -Infinity;
    // 如果s与t在同一个父亲节点以下，就说明我们已经累加到这棵树的根部了。
    //当s与t在同一个父亲节点下时，t-s=1，那么s^t=1,s^t^1=0,此时就退出循环。
    for(s+=m-1,t+=m+1;s^t^1;s>>=1,t>>=1) {
        if(~s&1){
          ans=Math.max(ans,max[s^1]); //max[s^1]是max[s]的兄弟 
        }
        if(t&1){
           ans= Math.max(ans,max[t^1]); //max[t^1]是max[t]的兄弟 
        }
          
    }
    return ans;
}
  function queryRangeSum(s, t) {
    var rangeSum = 0
    // 如果s与t在同一个父亲节点以下，就说明我们已经累加到这棵树的根部了。
    //当s与t在同一个父亲节点下时，t-s=1，那么s^t=1,s^t^1=0,此时就退出循环。
    for (s += m - 1, t += m + 1; s ^ t ^ 1; s >>= 1, t >>= 1) {
      if (s % 2 === 0) {
        rangeSum += (sum[s ^ 1] || 0) //max[s^1]是max[s]的兄弟 
      }
      if (t % 2 !== 0) {
        rangeSum += (sum[t ^ 1] || 0) //max[t^1]是max[t]的兄弟 
      }

    }
    return rangeSum;
  }
console.log(queryRangeSum(2,5))
    </script>
  <div id='root'></div>
</body>

</html>

