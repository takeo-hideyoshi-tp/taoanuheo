<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

  <script>
    class SuffixNode {
      constructor(value) {
        this.value = value
        this.splitLength = 0;
        this.isActive = false;
        this.children = []
        this.hidden = false;
      }
    }

    class SuffixTree {
      constructor() {
        this.root = new SuffixNode('');
      }
      insert(word, sign) {
        sign = sign || '#'
        var nodes = this.root.children;
        word += sign;
        for (var i = 0; i < word.length; i++) {
          this.addNodeByChar(nodes, word[i], false)
        }
      }

      addNodeByChar(nodes, ch, isChild) {
        var add = true;
        if (isChild) {
          add = false
        }
        for (var i = 0; i < nodes.length; i++) {
          var node = nodes[i]
          var isMatch = node.value[node.splitLength] === ch
          //没有命中，没有隐藏
          if (!node.hidden) {
            node.value += ch;
          }
          if (!isMatch) {
            if (node.isActive) {//处于激活狀态
              node.isActive = false;
              node.hidden = true; //进行分叉
              var value = node.value;
              node.value = value.slice(0, node.splitLength)//变成父节点
              node.children.push(
                new SuffixNode(value.slice(node.splitLength, -1)),
                new SuffixNode(''),
              )
              node.splitLength = 0;
            }
          } else { //命中了，就不用在根节点中添加新节点
            add = false;
            node.splitLength++
            if (!node.hidden) { //没有分叉过
              node.isActive = true;
            }
          }
          //如果有孩子，可以继续传递ch
          if (node.children.length) {
            this.addNodeByChar(node.children, ch, true)
          }
        }

        if (add && ch !== '#') {
          nodes.push(new SuffixNode(ch))
        }
      }
    }

    var tree = new SuffixTree();
    //tree.insert("banana");
    tree.insert("abcabxabcd"); //con
    console.log(tree)

    //abcabxabcd
    // bcabxabcd
    //  cabxabcd
    //   abxabcd
    //    bxabcd
    //     xabcd
    //      abcd
    //       bcd
    //        cd
    //         d


  </script>
  <div id='root'></div>
</body>

</html>